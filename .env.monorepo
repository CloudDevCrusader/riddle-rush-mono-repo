# ===========================================
# MONOREPO ENVIRONMENT CONFIGURATION
# Optimized for Turborepo + pnpm Workspace
# ===========================================
# This file provides a monorepo-optimized environment setup
# with workspace-aware variables and shared configuration

# ===========================================
# MONOREPO CORE CONFIGURATION
# ===========================================
# Workspace root directory (automatically detected by Turbo)
WORKSPACE_ROOT=${WORKSPACE_ROOT:-$(pwd)}

# Current workspace package (automatically detected)
WORKSPACE_PACKAGE=${WORKSPACE_PACKAGE:-$(basename $(pwd))}

# Monorepo mode (affects how environment variables are loaded)
MONOREPO_MODE=${MONOREPO_MODE:-true}

# ===========================================
# SHARED ENVIRONMENT VARIABLES
# ===========================================
# Variables shared across all workspaces

# Development environment (shared)
NODE_ENV=${NODE_ENV:-development}

# Base configuration (shared)
APP_VERSION=${npm_package_version:-1.0.0}
APP_NAME="Riddle Rush Monorepo"

# ===========================================
# WORKSPACE-SPECIFIC CONFIGURATION
# ===========================================
# Variables that can be overridden by individual workspaces

# Game App Configuration (apps/game)
GAME_BASE_URL=${GAME_BASE_URL:-/}
GAME_PUBLIC_SITE_URL=${GAME_PUBLIC_SITE_URL:-}
GAME_GOOGLE_ANALYTICS_ID=${GAME_GOOGLE_ANALYTICS_ID:-G-JJ3FRF41GW}

# Docs App Configuration (apps/docs)
DOCS_BASE_URL=${DOCS_BASE_URL:-/docs}
DOCS_PUBLIC_SITE_URL=${DOCS_PUBLIC_SITE_URL:-}

# ===========================================
# TURBOREPO OPTIMIZATION
# ===========================================
# Environment variables optimized for Turbo caching

# Turbo cache configuration
TURBO_CACHE_DIR=${TURBO_CACHE_DIR:-.turbo/cache}
TURBO_TEAM=${TURBO_TEAM:-}
TURBO_TOKEN=${TURBO_TOKEN:-}
TURBO_REMOTE_ONLY=${TURBO_REMOTE_ONLY:-false}

# Turbo remote caching
TURBO_REMOTE_CACHE_SIGNATURE=${TURBO_REMOTE_CACHE_SIGNATURE:-false}

# ===========================================
# PNPM WORKSPACE CONFIGURATION
# ===========================================
# pnpm workspace-specific variables

# pnpm configuration
PNPM_HOME=${PNPM_HOME:-~/.pnpm}
PNPM_STORE_DIR=${PNPM_STORE_DIR:-~/.pnpm-store}

# Workspace filtering
PNPM_FILTER=${PNPM_FILTER:-}

# ===========================================
# SHARED SERVICES & APIs
# ===========================================
# Services used across multiple workspaces

# Shared API configuration
SHARED_API_SECRET=${SHARED_API_SECRET:-}
SHARED_API_TIMEOUT=${SHARED_API_TIMEOUT:-10000}

# External services (shared)
PETSCAN_API_URL=${PETSCAN_API_URL:-https://petscan.wmflabs.org}
SENTRY_DSN=${SENTRY_DSN:-}

# ===========================================
# MONOREPO FEATURE FLAGS
# ===========================================
# Feature flags that apply across the monorepo

# Global feature flags
ENABLE_DEBUG_PANEL=${ENABLE_DEBUG_PANEL:-false}
ENABLE_ANALYTICS=${ENABLE_ANALYTICS:-false}
ENABLE_PWA=${ENABLE_PWA:-true}

# Workspace-specific feature flags
GAME_ENABLE_FEATURE_FLAGS=${GAME_ENABLE_FEATURE_FLAGS:-true}
DOCS_ENABLE_FEATURE_FLAGS=${DOCS_ENABLE_FEATURE_FLAGS:-false}

# ===========================================
# CLOUD & INFRASTRUCTURE
# ===========================================
# Shared cloud infrastructure configuration

# AWS Configuration (shared)
AWS_REGION=${AWS_REGION:-eu-central-1}
AWS_S3_BUCKET=${AWS_S3_BUCKET:-riddle-rush-pwa-dev-720377205549}
AWS_CLOUDFRONT_ID=${AWS_CLOUDFRONT_ID:-E1ELWV312P4UJ8}

# CloudWatch (shared)
CLOUDWATCH_ENDPOINT=${CLOUDWATCH_ENDPOINT:-}
CLOUDWATCH_API_KEY=${CLOUDWATCH_API_KEY:-}
DEBUG_ERROR_SYNC=${DEBUG_ERROR_SYNC:-false}

# ===========================================
# MONOREPO BUILD OPTIMIZATION
# ===========================================
# Build optimization variables for Turbo

# Build optimization flags
TURBO_FORCE=${TURBO_FORCE:-false}
TURBO_LOG_ORDER=${TURBO_LOG_ORDER:-grouped}
TURBO_PREFETCH=${TURBO_PREFETCH:-true}

# Cache configuration
TURBO_CACHE_CONCURRENCY=${TURBO_CACHE_CONCURRENCY:-10}
TURBO_MEMORY_LIMIT=${TURBO_MEMORY_LIMIT:-4096}

# ===========================================
# WORKSPACE DETECTION LOGIC
# ===========================================
# Automatically detect which workspace is running

# Detect current workspace
if [ -f "apps/game/package.json" ]; then
  export WORKSPACE_PACKAGE="game"
  export WORKSPACE_TYPE="app"
elif [ -f "apps/docs/package.json" ]; then
  export WORKSPACE_PACKAGE="docs"
  export WORKSPACE_TYPE="app"
elif [ -f "packages/shared/package.json" ]; then
  export WORKSPACE_PACKAGE="shared"
  export WORKSPACE_TYPE="package"
elif [ -f "packages/types/package.json" ]; then
  export WORKSPACE_PACKAGE="types"
  export WORKSPACE_TYPE="package"
elif [ -f "packages/config/package.json" ]; then
  export WORKSPACE_PACKAGE="config"
  export WORKSPACE_TYPE="package"
else
  export WORKSPACE_PACKAGE="root"
  export WORKSPACE_TYPE="root"
fi

# ===========================================
# ENVIRONMENT LOADING ORDER
# ===========================================
# 1. Root .env.monorepo (lowest priority - defaults)
# 2. Workspace-specific .env (medium priority - overrides)
# 3. CI/CD environment variables (highest priority - final overrides)
# 4. Local .env.*local files (development only - highest priority)

# ===========================================
# MONOREPO BEST PRACTICES
# ===========================================
# 1. Use WORKSPACE_* variables for workspace detection
# 2. Prefix shared variables with SHARED_*
# 3. Use workspace-specific prefixes (GAME_*, DOCS_*, etc.)
# 4. Keep sensitive variables in CI/CD, not in .env files
# 5. Use .env.*local for local development overrides

# ===========================================
# USAGE EXAMPLES
# ===========================================

# Access in JavaScript/TypeScript:
# process.env.WORKSPACE_PACKAGE  // "game", "docs", "shared", etc.
# process.env.WORKSPACE_ROOT     // Root directory path
# process.env.GAME_BASE_URL      // Game-specific variable
# process.env.SHARED_API_SECRET  // Shared variable

# Access in Nuxt runtimeConfig:
# useRuntimeConfig().public.baseUrl

# ===========================================
# MONOREPO ENVIRONMENT VARIABLES
# ===========================================
# This section defines variables specifically optimized for monorepo usage

# Monorepo-wide debugging
MONOREPO_DEBUG=${MONOREPO_DEBUG:-false}

# Shared build configuration
SHARED_BUILD_CACHE=${SHARED_BUILD_CACHE:-true}
SHARED_BUILD_CONCURRENCY=${SHARED_BUILD_CONCURRENCY:-4}

# Cross-workspace communication
SHARED_EVENT_BUS=${SHARED_EVENT_BUS:-false}
SHARED_STATE_MANAGEMENT=${SHARED_STATE_MANAGEMENT:-false}

# ===========================================
# TURBO PIPELINE OPTIMIZATION
# ===========================================
# Optimize Turbo pipeline execution

# Pipeline-specific variables
TURBO_PIPELINE=${TURBO_PIPELINE:-default}
TURBO_TARGET=${TURBO_TARGET:-all}

# Pipeline caching
TURBO_CACHE_SCOPE=${TURBO_CACHE_SCOPE:-workspace}
TURBO_CACHE_KEY=${TURBO_CACHE_KEY:-}

# ===========================================
# PNPM WORKSPACE OPTIMIZATION
# ===========================================
# Optimize pnpm workspace usage

# pnpm workspace variables
PNPM_WORKSPACE_CONCURRENCY=${PNPM_WORKSPACE_CONCURRENCY:-4}
PNPM_STRICT_PEER_DEPENDENCIES=${PNPM_STRICT_PEER_DEPENDENCIES:-false}
PNPM_SHARED_WORKSPACE_LOCKFILE=${PNPM_SHARED_WORKSPACE_LOCKFILE:-true}

# ===========================================
# MIGRATION NOTES
# ===========================================
# This file replaces the previous split configuration:
# - .env (root) + apps/game/.env â†’ .env.monorepo
# - All variables now centralized with workspace detection
# - Maintains backward compatibility with existing code

# ===========================================
# MONOREPO ENVIRONMENT SETUP COMPLETE
# ===========================================
# For more information, see MONOREPO_ENVIRONMENT_GUIDE.md
# Last updated: 2024-01-11